pipeline {
    agent any

    

   
    stages { 

        
     
         

       
       stage('snyk scan') {
            steps {
                      
                  snykSecurity( 
                    snykInstallation: 'snyk@latest', 
                    snykTokenId: 'snyk_api_token', 
                    monitorProjectOnBuild: false,
                    failOnIssues: 'false', 
                    additionalArguments: '--json-file-output=all-vulnerabilities.json'
                )     
                 


            }
        }
      
       stage('sonarcloud scan') {
            steps {
               script{  
                          withSonarQubeEnv(installationName: 'SonarCloud', credentialsId: 'SONARCLOUD_TOKEN') {
                          withMaven(maven: 'maven'){
                          sh "  mvn clean verify sonar:sonar \
                              -Dsonar.token=SONARCLOUD_TOKEN\
                              -Dsonar.host.url=https://sonarcloud.io \
                              -Dsonar.organization=deepak4566 \
                               -Dsonar.projectKey= deepak4566_spring-petclinic -Dcheckstyle.skip" 
                   }  
                       }

                 }


            }
        }

       stage('building a docker image  ') {
         steps{
           script {
             sh "docker build -t deepak8934/petapp:${BUILD_NUMBER} ."
             
                
        }
          
      }
    } 
 
      
        
    }
}
