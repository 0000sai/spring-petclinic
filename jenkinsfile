pipeline {
 agent any
   

                 

   
    stages { 

        

     stage('maven build and test') {
            steps {	           
                sh 'ls -ltr'	
                sh 'mvn clean package -Dskiptests=true -Dcheckstyle.skip  -fn '
                                  }
                                       }
     
    


  
         

       
       stage('snyk scan') {
            steps {
                      
                  snykSecurity( 
                    snykInstallation: 'snyk@latest', 
                    snykTokenId: 'snyk_api_token', 
                    monitorProjectOnBuild: false,
                    failOnIssues: 'false', 
                    additionalArguments: '--json-file-output=all-vulnerabilities.json'
                )     
                 


            }
        }
      

        
     


    







       stage('building a docker image  ') {
         steps{
           script {
             sh "docker build -t deepak8934/petapp:${BUILD_NUMBER} ."
             
                
        }
          
      }
    } 
         
     stage('docker image push'){
           steps{
              script { withDockerRegistry(credentialsId: 'dockercred', url: ''){
                  sh " docker push  deepak8934/petapp:${BUILD_NUMBER} "} }
                                       }
          
                                                                      
                                                






}
 
      
        
    }
}

